<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDU-LEAGUE Team Logo Manager</title>
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #f0f2f5;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg-color); 
            margin: 0;
            padding: 20px;
        }

        h1 { 
            text-align: center; 
            color: var(--primary-color);
            margin-bottom: 30px;
        }
        
        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .team-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            transition: transform 0.2s;
            border: 1px solid #e1e1e1;
        }

        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .logo-wrapper {
            width: 140px;
            height: 140px;
            margin: 0 auto 15px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #f8f9fa;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .team-logo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        h3 { margin: 10px 0 5px; color: var(--primary-color); }
        p { color: #666; margin: 0 0 15px; font-size: 0.9em; }

        /* Custom File Upload Button */
        .upload-container {
            position: relative;
            margin-top: 15px;
        }

        .custom-file-upload {
            display: inline-block;
            padding: 8px 20px;
            cursor: pointer;
            background-color: var(--accent-color);
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .custom-file-upload:hover {
            background-color: #2980b9;
        }

        input[type="file"] {
            display: none; /* Hide default ugly input */
        }

        .status-msg { 
            font-size: 0.85em; 
            margin-top: 8px; 
            min-height: 20px; 
            font-weight: bold;
        }
        .text-uploading { color: #e67e22; }
        .text-success { color: #27ae60; }
        .text-error { color: #c0392b; }
    </style>
</head>
<body>

    <h1>Team Logo Management</h1>
    
    <div id="teams-container" class="teams-grid">
        <p style="text-align:center; width:100%; font-size:1.2em; color:#666;">Loading teams from database...</p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

    <script>
        // ==========================================
        // 1. CONFIGURATION SECTION
        // ==========================================
        
        // PASTE YOUR KEYS INSIDE THE QUOTES BELOW
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const storage = firebase.storage();

        // DEFAULT LOGO: Change this URL to your general Department/League Logo
        const DEFAULT_LOGO = "https://via.placeholder.com/150?text=EDU-LEAGUE"; 

        // ==========================================
        // 2. RENDER LOGIC
        // ==========================================
        const teamsContainer = document.getElementById('teams-container');

        // Listen to "teams" collection in real-time
        db.collection("teams").onSnapshot((snapshot) => {
            teamsContainer.innerHTML = ""; // Clear existing cards
            
            if(snapshot.empty) {
                teamsContainer.innerHTML = "<p>No teams found in database.</p>";
                return;
            }

            snapshot.forEach((doc) => {
                const team = doc.data();
                const teamId = doc.id;
                
                // DECISION: Use Custom Logo if exists, otherwise use Default
                const displayLogo = team.logo ? team.logo : DEFAULT_LOGO;

                const cardHtml = `
                    <div class="team-card">
                        <div class="logo-wrapper">
                            <img src="${displayLogo}" alt="${team.name}" class="team-logo">
                        </div>
                        <h3>${team.name || "Unnamed Team"}</h3>
                        <p>${team.division || "No Division"}</p>

                        <div class="upload-container">
                            <label for="file-${teamId}" class="custom-file-upload">
                                Update Logo
                            </label>
                            <input id="file-${teamId}" type="file" onchange="uploadLogo(event, '${teamId}')" accept="image/*">
                        </div>
                        <div id="status-${teamId}" class="status-msg"></div>
                    </div>
                `;
                
                teamsContainer.innerHTML += cardHtml;
            });
        });

        // ==========================================
        // 3. UPLOAD FUNCTION
        // ==========================================
        function uploadLogo(event, teamId) {
            const file = event.target.files[0];
            if (!file) return;

            // UI Feedback
            const statusDiv = document.getElementById(`status-${teamId}`);
            statusDiv.textContent = "Uploading...";
            statusDiv.className = "status-msg text-uploading";

            // 1. Create Storage Reference: teams/TEAM_ID/filename
            const storagePath = `teams/${teamId}/${Date.now()}_${file.name}`;
            const storageRef = storage.ref(storagePath);
            const uploadTask = storageRef.put(file);

            // 2. Monitor Upload
            uploadTask.on('state_changed', 
                (snapshot) => {
                    // Optional: Calculate progress % here if needed
                }, 
                (error) => {
                    console.error("Upload Error:", error);
                    statusDiv.textContent = "Upload Failed!";
                    statusDiv.className = "status-msg text-error";
                }, 
                () => {
                    // 3. Upload Complete - Get URL
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        
                        // 4. Update Firestore for THIS team only
                        db.collection("teams").doc(teamId).update({
                            logo: downloadURL
                        }).then(() => {
                            statusDiv.textContent = "Success! Logo Updated.";
                            statusDiv.className = "status-msg text-success";
                            
                            // Reset message after 3 seconds
                            setTimeout(() => {
                                statusDiv.textContent = "";
                            }, 3000);
                        });
                    });
                }
            );
        }
    </script>
</body>
</html>