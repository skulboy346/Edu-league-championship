<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration - EDU-LEAGUE</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6d28d9">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="icon" href="edulogo.jpg" type="image/jpeg">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fd; }
        .bg-edu-purple { background-color: #6d28d9; } .text-edu-purple { color: #6d28d9; }
        .slide { display: none; animation: fade 1.5s; } .slide.active { display: block; }
        @keyframes fade { from {opacity: .4} to {opacity: 1} }
    </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

    <a href="admin.html" class="fixed bottom-6 right-6 bg-gray-900 text-white w-12 h-12 flex items-center justify-center rounded-full shadow-2xl hover:bg-edu-purple hover:scale-110 transition z-50 border-2 border-white" title="Admin Login"><i class="fa-solid fa-lock"></i></a>

    <div class="bg-edu-purple text-white py-2 px-4 flex justify-between items-center z-50 relative shadow-md">
        <span class="text-[10px] md:text-xs font-bold tracking-widest opacity-90">OFFICIAL NUESA SPORTS PLATFORM</span>
        <div class="flex space-x-4">
            <a href="https://wa.me/2348113032943" target="_blank" class="hover:text-green-400"><i class="fa-brands fa-whatsapp"></i></a>
        </div>
    </div>

    <div class="relative w-full h-48 bg-gray-900 overflow-hidden">
        <div class="slide active w-full h-full relative"><img src="https://images.unsplash.com/photo-1579952363873-27f3bade9f55?q=80&w=1200" class="w-full h-full object-cover opacity-40"><div class="absolute inset-0 flex flex-col items-center justify-center text-white text-center px-4"><h1 class="text-3xl font-black uppercase tracking-widest text-yellow-400 drop-shadow-lg">Championship 2025</h1></div></div>
        <div class="slide w-full h-full relative"><img src="https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=1200" class="w-full h-full object-cover opacity-40"><div class="absolute inset-0 flex flex-col items-center justify-center text-white text-center px-4"><h1 class="text-3xl font-black uppercase tracking-widest text-green-400 drop-shadow-lg">Unite & Conquer</h1></div></div>
    </div>

    <main class="flex-grow flex items-center justify-center p-4 -mt-10 z-10 relative">
        <div class="max-w-4xl w-full bg-white shadow-2xl rounded-xl overflow-hidden flex flex-col md:flex-row">
            <div class="bg-edu-purple w-full md:w-1/3 p-8 text-white text-center">
                <img src="edulogo.jpg" class="h-24 w-24 rounded-full border-4 border-white mb-4 object-cover mx-auto shadow-lg">
                <h2 class="text-2xl font-extrabold">Coach's Portal</h2>
                <p class="mt-2 text-purple-200 text-sm">Register your team.</p>
            </div>

            <div class="w-full md:w-2/3 p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Team Registration</h2>
                <form id="regForm" class="space-y-5">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                        <select id="department" required class="w-full border-gray-300 border rounded-lg p-3 bg-gray-50">
                            <option value="">Select Department</option>
                            <option value="Adult Education">Adult Education (NAAES)</option>
                            <option value="Arts Education">Arts Education (AESA)</option>
                            <option value="Educational Foundations">Educational Foundations (EFSA)</option>
                            <option value="Educational Management">Educational Management (EMSA)</option>
                            <option value="Human Kinetics">Human Kinetics (HKHE)</option>
                            <option value="Vocational Education">Vocational Education (TVESA)</option>
                            <option value="Science Education">Science Education (ULSESA)</option>
                            <option value="Social Sciences">Social Sciences (SESSA)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Division</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="p-3 border rounded-lg flex items-center hover:bg-gray-50"><input type="radio" name="level" value="Finalist" required class="mr-2 text-edu-purple">Finalist (400L)</label>
                            <label class="p-3 border rounded-lg flex items-center hover:bg-gray-50"><input type="radio" name="level" value="Penultimate" required class="mr-2 text-edu-purple">Penultimate (300L)</label>
                            <label class="p-3 border rounded-lg flex items-center hover:bg-gray-50"><input type="radio" name="level" value="Sophomore" required class="mr-2 text-edu-purple">Sophomore (200L)</label>
                            <label class="p-3 border rounded-lg flex items-center bg-pink-50 hover:bg-pink-100"><input type="radio" name="level" value="Female" required class="mr-2 text-pink-600">Female League</label>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="coachName" placeholder="Coach Name" required class="border-gray-300 border rounded-lg p-3 w-full">
                        <input type="tel" id="phone" placeholder="WhatsApp Number" required class="border-gray-300 border rounded-lg p-3 w-full">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 pt-2">
                        <button type="submit" id="submitBtn" class="w-full bg-edu-purple text-white font-bold py-4 rounded-lg hover:bg-purple-700 transition shadow-lg flex justify-center items-center gap-2">
                            <span>Proceed</span> <i class="fa-solid fa-arrow-right"></i>
                        </button>
                        <button type="button" onclick="window.location.href='team_roster.html'" class="w-full bg-green-600 text-white font-bold py-4 rounded-lg hover:bg-green-700 transition shadow-lg flex justify-center items-center gap-2">
                            <i class="fa-solid fa-upload"></i> <span>Upload List</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDtxFsLYoe0NYlZRWiXgEM90IYKMwx7K8s", authDomain: "sonic-verbena-239117.firebaseapp.com", projectId: "sonic-verbena-239117", storageBucket: "sonic-verbena-239117.appspot.com", messagingSenderId: "652544574249", appId: "1:652544574249:web:6ff33771307e892e7f6d38", measurementId: "G-TD780JGNED" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app); const auth = getAuth(app);

        // Slideshow
        let slideIndex = 0;
        const showSlides = () => {
            let slides = document.getElementsByClassName("slide");
            for (let i = 0; i < slides.length; i++) slides[i].classList.remove("active");
            slideIndex++; if (slideIndex > slides.length) slideIndex = 1;
            slides[slideIndex - 1].classList.add("active"); setTimeout(showSlides, 4000);
        }
        showSlides();

        document.getElementById('regForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn'); btn.disabled = true; btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Processing...';
            const dept = document.getElementById('department').value; 
            const lvl = document.querySelector('input[name="level"]:checked').value;
            const teamName = `${dept} (${lvl})`; // Standard Name Format

            try {
                await signInAnonymously(auth);
                // Check for duplicates
                const q = query(collection(db, "registrations"), where("department", "==", dept), where("level", "==", lvl));
                const snap = await getDocs(q);
                if (!snap.empty) { alert("Team already registered! Redirecting..."); localStorage.setItem('eduLeagueTeamID', snap.docs[0].id); window.location.href=`payment_receipt.html?teamId=${snap.docs[0].id}`; return; }
                
                // Register
                const docRef = await addDoc(collection(db, "registrations"), {
                    department: dept, level: lvl, teamName: teamName,
                    coachName: document.getElementById('coachName').value,
                    phone: document.getElementById('phone').value, 
                    registrationStatus: "Pending Payment", registeredAt: serverTimestamp()
                });
                
                // Save ID & Redirect
                localStorage.setItem('eduLeagueTeamID', docRef.id); 
                window.location.href = `payment_receipt.html?teamId=${docRef.id}`;
            } catch (error) { console.error(error); alert("Connection Failed."); btn.disabled = false; btn.innerText = "Proceed"; }
        });
    </script>
</body>
</html>